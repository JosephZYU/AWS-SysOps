VPC with EC2 instances.

Ensure the instance can initiate traffic outgoing to the internet. 

NO incoming connection can be initiated from the Internet

The keyword here is Outgoing ONLY + NO incoming == Egress-ONLY Internet gateway

Another great hint is that IPv6 => Egress ONLY for IPv6 connections


Pre-requisite needs to be followed to ensure IPv6:


Ensure your VPC works in Dual stack mode.

IPv4 + IPv6 == Dual Stack mode - they are independent of each other.


2 resources records based on the Weighted Routing policy

‚ö° Weighted Routing policy == great for load balancing and testing new versions of software


Simple Routing  Standard DNS records - basic function - deprecated in most cases
Latency-based Routing   Multiple AWS Regions based on best latency - customer experience improvement
Geo-location Routing    Strictly based on location of your end users - language / regulations / compliance
Weighted Routing    Testing / Beta / Load Balancing right before final stage - split traffic to be directed


Critical drug formula - high confidential
Multiple locations globally
Block public access to all NEW users accessing documents uploaded in the bucket - BLOCK ALL new users



S3 - Permissions - Block Public Access

In order to ensure that public access to all your S3 buckets and objects is blocked, turn on Block all public access. These settings apply only to this bucket and its access points.


Use S3 Block Public Access with BlockPublicAcls setting at bucket level
    ‚Ä¢ ACL - access control list - Block Public Acls
    ‚Ä¢ Bucket level vs. Object level








‚ö° 

Block Public ACLs   Absolutely BLOCK ALL new ACLs - ‚ùó Stop Resolutely
Ignore Public ACLs  Block public access BUT doesn't prevent new public ACLs from being set - still Open to new set up üëÄ

üèõ https://docs.aws.amazon.com/cli/latest/reference/s3api/put-public-access-block.html




Media firm - Convertible Reserved Instance - Reserved Instance cost details - Detailed Billing Report

AWS Cost & Usage Report vs. Detailed Billing Report




Multiple files with flexible column structure - migrating from Detailed Billing Reports to Cost and Usage Reports
‚ö°
Detailed Billing Report (DBR)   Legacy
Cost and Usage Reports (CUR)    NEW - comprehensive - complex needs - dedicated queries - Additional Columns NOT in DBR



CUR - the better solution - Cost and Usage Report - complex queries - multiple files with flexible column structure

Web-app behind ELB - huge financial loss - web app secure against external attacks




Use AWS WAF to create a regular rule to deny IP address & SQL attacks on applications.

WAF - basic starting point - customized solution to block attacks - highly detailed and customized metrics
    ‚Ä¢ SQL injection
    ‚Ä¢ IP address
    ‚Ä¢ Cross-site scripting
    ‚Ä¢ Length o frequent
    ‚Ä¢ String match
    ‚Ä¢ Geographic match

Shield - DDoS attack - managed solution - additional protection - advanced dedicated extra layer of protection against DDoS focus

DNS Resolution and hostnames - ensure the Route table is modified

Internet Gateway / Nat Gateway can ONLY be attached at the VPC level - which is a very top level on the hierarchy! - at the boundary to in/exit

Additional step == Edit the Route Table

    ‚Ä¢ Nat / Internet Gateway ‚úÖ
    ‚Ä¢ Security / NACL ‚úÖ
    ‚Ä¢ Edit the Route Table - the final additional step


DynamoDB table - DB - security 
    ‚Ä¢ A trust policy that allows the EC2 instance to assume a role
    ‚Ä¢ An IAM permission policy that allows the user to pass a role




‚ö°üß† 
    ‚Ä¢ Trust policy - EC2 instance - assume a role ‚õë
    ‚Ä¢ IAM permission policy - user - pass a role ü§ù


Legal - contractual documents == Vault Lock 

Additional actions to initiated to complete S3 Glacier Vault lock policy - initiate complete Vault Lock operation within 24 hours using Lock ID generated during Initiate Vault Lock

Must use the ORIGINAL lock ID generated during Initiate Vault Lock - the origin must be used to authenticate the real user.

‚ö° Vault - 24 Hours - Origin Lock ID (generated during initiate set up)


Actively used account - external audit - list of users - MFA status

Go to IAM and download the Credentials Report (for MAF status)




Use AWS Organizations and Service Control Policies (SCP)
    ‚Ä¢ Multiple accounts in AWS
    ‚Ä¢ Actions / services NOT allowed ‚õî across ALL accounts.
    ‚Ä¢ The most effective way


Initiate an archive retrieval job specifying archive ID & using Bulk retrieval option
    ‚Ä¢ Large engineering firm - S3 Glacier
    ‚Ä¢ 1 PB audited - annual audit
    ‚Ä¢ In one week
        ‚Ä¢ Expedited - 5 mins
        ‚Ä¢ Standard - 5 hours
        ‚Ä¢ Bulk - 12 hours
    ‚Ä¢ Retrieve data at lowest costs üí≤

‚ö° archive retrieval job + archive ID + Bulk retrieval option - why archive ID vs. Job ID

    Archive x 2




Bucket B has SSE-KMS encryption enabled which is NOT supported
    ‚Ä¢ S3 server access logs - Production S3 bucket
    ‚Ä¢ Prod - encrypted - SSE-KMS üîê
    ‚Ä¢ Source Bucket - A
    ‚Ä¢ Target Bucket - B - logs must be encrypted SSE-S3 - which is NOT compatible with SSE-KMS
    ‚Ä¢ Find out who deleted critical files from S3 buckets
    ‚Ä¢ No logs are generated - complete silence - Security Group / NO access at all

Bucket B which is the Target Bucket has KMS encryption enabled which is NOT supported



‚ö° Logs to be delivered in the target bucket B - it should have bucket encryption as SSE-S3 NOT SSE-KMS


Ensure that the client with the IP of 54.240.143.188 is DENIED access to the objects in the demo bucket
    ‚Ä¢ Effect: Allow
    ‚Ä¢ Principal: *
    ‚Ä¢ Action: S3:*
    ‚Ä¢ Resource: arn:aws:s3::demo bucket/*
    ‚Ä¢ Condition:
        ‚Ä¢ NOT IP Address: 54.240.143.188/32 - this specific IP / 32 is DENIED - which is an explicit deny ‚õî


Actions are mandatory to complete systems manager set up on the server:
    ‚Ä¢ Download & install SSM Agent on servers in Data Centre
    ‚Ä¢ Create an IAM role to communicate with the System Manager Service
    ‚Ä¢ Install a TLS certificate on servers in Data Centre
    ‚Ä¢ Create a managed Instance activation for servers in Data Centre

üèõ https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-managedinstances.html

Use State manager with Command Document:
    ‚Ä¢ SysOps admin - construction company
    ‚Ä¢ Outage in critical prod servers
    ‚Ä¢ Maintain a pre-defined state for all instance in US-West-1 region

Command Document == pre-defined state

Policy Document Apply policy on EC2 instance
Automation Document Performing automation tasks
Package document    Create zip folder to be installed on target instance
Command Document    Pre-defined state for all instance in one region

Request users from the master account to modify the Threat List to include this IP address:
    ‚Ä¢ Large MNC - 3-tier app 
    ‚Ä¢ Amazon GuardDuty - monitoring malicious activities
    ‚Ä¢ Observe huge amount of traffic from an IP address

You must request from the top - the master account to modify the Threat list to include this IP address

GuardDuty:
    ‚Ä¢ Trusted IP list
    ‚Ä¢ Threat List

Users for the Master Account has permission to upload and mange IP address in Trusted IP address and Threat list

‚ö° ONLY Master Account has been authorized to modify the Threat List!


Create a filter for specific attribute generating this finding and archive the rule - filter and put them into archive directly

    ‚Ä¢ Start up firm GuardDuty - master and member account - monitor
    ‚Ä¢ Email notification to IT
    ‚Ä¢ Prevent findings to initialize CloudWatch events repeatedly and sending mails for a know issue

Create a filter for specific attribute generating this finding and archive the rule

‚ö° filter ‚úÇ for specific attribute generating this finding and archive the rule and auto archived üóÑ




    ‚Ä¢ GuardDuty rules can NOT be disabled or deleted == can ONLY be archived

üé¨ AWS Office Hours: Amazon GuardDuty Tips and Tricks - AWS Online Tech Talks ‚è∞

    ‚Ä¢ if I enable that "Auto-archive" and say archive these findings and I save this going forward any finding that matches this filter will automatically be sent to the archive 
    ‚Ä¢ and it will not be sent out cloud watch events == filtered ‚úÇ


Use System Manger Parameter Store (SSM) to store application password
    ‚Ä¢ Securely update app password with least efforts
    ‚Ä¢ Ensure no service outage

credentials / passwords == SSM parameter store

Use SSM Parameter Store to securely access secrets and config data in AWS CodeDeploy

VPC gateway endpoint needs to be attached to the VPC
    ‚Ä¢ Created your own VPC
        ‚Ä¢ Public Sub
        ‚Ä¢ Private Sub
    ‚Ä¢ Private Sub instance - S3 (AWS internal service ONLY) >> VPC Gateway Endpoint
    ‚Ä¢ VPC Endpoint for Amazon S3

Create a VPC endpoint policy to provide access to S3 buckets used by Patch Manager
    ‚Ä¢ VPC endpoint - improve security - no external navigation over the public web
    ‚Ä¢ User Data scripts for aws
    ‚Ä¢ System manager patch manager to patch EC2 instance
    ‚Ä¢ Ensure successful patching of EC2 instance

What is Patch Manager?

Patch baseline document - baseline operation / command


Install the CloudWatch agent on both sets of servers
Setup the metrics dashboard in CloudWatch
    ‚Ä¢ IT admin
    ‚Ä¢ Set of servers in AWS and on-prem
    ‚Ä¢ Monitorüßê system level metrics for both AWS and on-prem
    ‚Ä¢ Unified dashboard for monitor üñ•

Install the CloudWatch agent on both set
Set up metrics dashboard in CloudWatch

‚ö° CloudWatch:
    ‚Ä¢ Unified performance metrics dashboard
    ‚Ä¢ CloudWatch agent üë∑‚Äç‚ôÇÔ∏è can be installed on both AWS and on-prem

Enterprise
    ‚Ä¢ Highly critical revenue app
    ‚Ä¢ Purchase right support plan
    ‚Ä¢ Response of 30 mins or less for critical issue

AWS Support Plans:
    ‚Ä¢ Developer
    ‚Ä¢ Business
    ‚Ä¢ Enterprise - business critical system < 15 mins!


Create an Amazon CloudWatch graph with metric math expression to get total throughput for all EFS with metric as Total Bytes
    ‚Ä¢ EFS - file sharing (NFS)
    ‚Ä¢ Multiple AZ
    ‚Ä¢ Total throughput (total volume of traffic) of data being accessed from EFS mount point across ALL AZ
    ‚Ä¢ Get total throughput of EFS in a scalable manner with least efforts

Create an Amazon CloudWatch graph with metric math expression to get total throughput

‚ö° Math Expression:
    ‚Ä¢ Simplified
    ‚Ä¢ Near real-time
    ‚Ä¢ Single graph for multiple metrics for AWS resources using math expression


Use AWS Config Rules to check the Security Groups
    ‚Ä¢ Staging environments - promote to Production
    ‚Ä¢ Ensure SSH is disabled - NO SSH into these instances
    ‚Ä¢ 500 instances to manage

Use AWS Config Rules to check the Security Groups

AWS Config Rules == Dynamic compliance checking for Cloud Resources

‚ö° AWS Config
    ‚Ä¢ Quick exam on cloud resources / point in time settings
    ‚Ä¢ Resources configurations ‚öô quick inspect üëÄ
    ‚Ä¢ Great for agile DevOps -track ASAP for compliance and best practices
    ‚Ä¢ Evaluate existing config for better efficiency


Create a private hosted zone & resource record set for EFS mount target IP address
    ‚Ä¢ VPC peering connection
    ‚Ä¢ EFS in Sales VPC
    ‚Ä¢ Additional required to be done for mounting EFS from another VPC

Create a private hosted zone & resource record set for EFS mount target IP address

To mount an EFS, either an IP address needs to be used or a private hosted zone can be created in Route 53


üèõ https://docs.aws.amazon.com/efs/latest/ug/manage-fs-access-vpc-peering.html#mount-fs-different-vpc

‚ö° Private Hosted Zone for Different VPC to mount EFS

üòé The primary objective of EFS is to create a sharing mechanism for the underlying file:

    EC2 from AZ-a
    
    EC2 from AZ-b
    



Create a DynamoDB global table to replicate DynamoDB tables between different regions.
    ‚Ä¢ Global fin tech
    ‚Ä¢ Three tier web app
    ‚Ä¢ No outage allowed / no downtime for critical app
    ‚Ä¢ DB - fully redundant - highly available
    ‚Ä¢ Db tier should NOT impact working of web app tier
    ‚Ä¢ Highly available database between these two regions

Create a DynamoDB global table to replicate DynamoDB tables between different regions.

‚ö° global corp. >> global Table of DynamoDB - replicate DynamoDB tables between different regions.

DynamoDB scattered in 3 different regions around the world - with 1 unified (gateway) point of Global App tier to Global Users

üèõ https://aws.amazon.com/dynamodb/global-tables/



Recall: the most commonly seen 3-tier
    ‚Ä¢ Web tier
    ‚Ä¢ App tier
    ‚Ä¢ DB tier

Storage gateway Cached Volumes
    ‚Ä¢ Expand on-prem storage
    ‚Ä¢ iSCSI targets >> Volume 


Recall:

File    EFS
Volume  iSCSI target - Cached vs. Stored
Tape    iSCSI - long term archive


Stored volumes  Mostly in store - at your local on-prem location    Async back up to S3 as point-in-time snapshot of entire data to S3 
Cached  Mostly in S3 - on AWS Cloud ONLY retain a copy of most-frequently accessed data locally - leave majority on AWS

‚ö° Stored Volume == In Your Store

Create Trails in the console be adding ARNs of Amazon S3 bucket in member account without any additional cross account access.
    ‚Ä¢ AWS organization - large number of accounts created in multiple regions
    ‚Ä¢ Critical files deleted from S3 in member account
    ‚Ä¢ avoid from happening again - configure CloudTrail for all member accounts within Org.
    ‚Ä¢ üéØ GOAL - BE ABLE to track (via CloudTrail) to track details (on who did it)
        ‚Ä¢ DO not allow any member account(s) within your org to delete critical files in S3
        ‚Ä¢ Deny Deletion - S3

Create Trails in the console by adding ARNs of Amazon S3 bucket in member account without any additional cross account access.

üèõ https://docs.aws.amazon.com/awscloudtrail/latest/userguide/creating-trail-organization.html 



‚ö° Add + ARN of Member Account (NO manual config for cross-account access)
    ‚Ä¢ Add member account ARN
    ‚Ä¢ NO additional cross-account access

Rules with Periodic triggers evaluates at a specified frequently while rules with configuration changes do NOT run evaluations

    ‚Ä¢ Sys ops Admin for media company
    ‚Ä¢ Video files & archives to S3
    ‚Ä¢ Stringent security guidelines
    ‚Ä¢ AWS Config - change management on settings and evaluate against best practices
    ‚Ä¢ Periodic triggers for running evaluation every 24 hours
    ‚Ä¢ STOP ‚õî Configuration Recorder unknowingly

The impact of turning off configuration recorder:
    ‚Ä¢ Rules with Periodic triggers evaluates at a specified frequency while rules with configuration changes do NOT run evaluations.

‚ö°üß† when Rule Evaluations recorder is off: == ONLY specified frequency will last - NO more changes
    ‚Ä¢ ONLY explicitly specified period evaluations will continue
    ‚Ä¢ NO more change will happen
        ‚Ä¢ Configuration change trigger do NOT run evaluations
        ‚Ä¢ Do not run evaluations for config changes
        
üèõ https://docs.aws.amazon.com/config/latest/developerguide/evaluate-config-rules.html#turning-off-configuration-recorder


    
    
SCP applied at OU level
    ‚Ä¢ Effect: Deny
    ‚Ä¢ Action: KMS Schedule Key Deletion
    ‚Ä¢ Resource: *

Will deny users & roles in all accounts all accounts within that OU to schedule a CMK deletion

Policy is applied ONLY to that particular OU - will deny users & roles in all accounts within that particular OU to schedule a CMK deletion

If applied at OU level >> ONLY applies to OU

NOTE: OU is a sub directory of your AWS Organization chart - which is ONLY applied at the OU level - has NO impact on other accounts affiliated with other Ous


Use the cfn-signal helper script
    ‚Ä¢ Design CloudFormation template - create set of EC2 instance and install an app package
    ‚Ä¢ Ensure stack is ONLY successful if packages gets installed ‚úÖ is based on the condition of another criteria


üé¨ https://www.udemy.com/course/ultimate-aws-certified-sysops-administrator-associate/learn/lecture/12905474#questions

    ‚Ä¢ Insert Sample Wait Condition into the script
    ‚Ä¢ Timeout: 2 minutes


Guaranteed Success!

NOTE: the stack creation completion will ONLY succeed given SampleWaitCondition is completed

‚ö° CloudFormation - stack deployment:
    ‚Ä¢ Use cfn-signal helper script
    ‚Ä¢ Wait Condition - set grace period condition

The cfn-signal helper script signals AWS CF to indicate whether EC2 instances have been created or updated.

Specify accounts & regions individually in Aggregator and authorize aggregator account to collect AWS Config configuration and compliance data


Memory Optimized:
    ‚Ä¢ Host Memcached - pure simple caching service
    ‚Ä¢ Provision the EC2 instances
    ‚Ä¢ Memory Optimized

Caching needed >> Memory Optimized R family

üèõ https://aws.amazon.com/ec2/instance-types/

General Purpose ATM ATM machine to withdraw
Compute Optimized   C   Compute Optimized
Accelerated Computing   P, G, F1    PG Formula 1
Memory Optimized    R, z1d, X   Remember that X
Storage Optimized   D, I, H Design my House


Create an ELB health check with Ping Port as 8080 with Health Check interval as 5 sec & unhealthy thresholds as default value:
    ‚Ä¢ Web app http protocol 8080
    ‚Ä¢ Multi AZ behind ALB
    ‚Ä¢ Cross zone load balancing - critical app
    ‚Ä¢ Detect immediately and terminate the instance asap

Create ELB health check with Ping Port as 8080
    ‚Ä¢ Port 8080 vs. Port 80
        ‚Ä¢ 
        ‚Ä¢ 80 is for insecure HTTP, not even HTTPS
        ‚Ä¢ 8080 is used for a personally hosted web server - custom port
    ‚Ä¢ Health Check interval: 5 seconds
        ‚Ä¢ Health Check interval üßê is time period between health checks performed at EC2 instance,
        ‚Ä¢ Unhealthy threshold is number of consecutive failed health checks before ELB consider EC2 as unhealth.
            ¬ß Count how many failed ‚ùå health checks in a row == Unhealthy threshold
        ‚Ä¢ In order to determine unhealthy EC2 immediately, Health Check interval should be minimum as 5 seconds
        ‚Ä¢ Unhealthy threshold should also be at least 2 consecutive count. 
    ‚Ä¢ Unhealthy thresholds: default

Create ELB health check with Port as 8080 (custom personal use) with Health Check interval as 5 seconds and unhealthy threshold as default value



‚ö° 5 seconds x Default 2 consecutive threshold

Financial firm:
    ‚Ä¢ Web app EC2 behind ELB
    ‚Ä¢ S3 static web - back up in case of outage
    ‚Ä¢ Route 53 - hosted zone
    ‚Ä¢ Route 53 health checks will help to meet this requirement:
        ‚Ä¢ Enable evaluate Health Checks for primary record type with routing policy as Failover in Route 53
        ‚Ä¢ Create alias target as static web site created on S3 bucket with failover record type as secondary with no associated health check


S3 static web site as backup for ELB dynamic web site, required:
    ‚Ä¢ Create a record set with routing policy as Failover. Failover record type as Primary & evaluate health check as yes.
    ‚Ä¢ For failover endpoint, create a record set with routing policy as Failover. Failover record type as secondary. Alias target as S3 bucket & evaluate health check as no.

Enable evaluate Health checks for primary record type with routing policy as Failover in Route 53

Create alias target as static web site created on S3 bucket with failover record type as secondary with no associated health check.

‚ö° 
    ‚Ä¢ Health checks: YES for primary record üßê - the primary needs to have health checks
    ‚Ä¢ routing policy: failover
    ‚Ä¢ Alias target: static web site == S3 bucket == secondary - no need for S3 to check health as the alias target


Three tier web app:
    ‚Ä¢ Web, App, Data
    ‚Ä¢ Global insurance company
    ‚Ä¢ RDS DB instance - us-west-1 region with Read Replica in ap-southeast-1
    ‚Ä¢ Security breach - harden / strength all DB
    ‚Ä¢ To create a road map for encrypting DB instance.
        ‚Ä¢ Read Replica should be encrypted with encryption key different from master instance & should be same as that used for Read Replica region.

‚ö° Master & RR:
    ‚Ä¢ Same region >> same key
    ‚Ä¢ Different region >> RR based on the region it is actually deployed (which is different from master instance)

Master & Read Replica   In same region  Encryption key should be the same
Master & Read Replica   Different regions   Encryption key should be used based on (from) the same region where your actual replica is deployed!

Migrated on-prem Data to AWS:
    ‚Ä¢ Deployed app in EC2, VPC, S3 buckets
    ‚Ä¢ On-prem: customized tool - log all activities made by users on servers
    ‚Ä¢ SNS - Security Team for changes made to server configuration & check unsecure ports on app
    ‚Ä¢ Similar tools in AWS
        ‚Ä¢ Use AWS Config to track changes in resources with respect to configuration rules
        ‚Ä¢ Use AWS CloudTrail to record API calls to AWS resources
        ‚Ä¢ Use Amazon Inspector for security assessment for app deployed on EC2 instances.

‚ö° similar tools:
    ‚Ä¢ Config = track changes in config settings / rules ‚öô
    ‚Ä¢ CloudTrail = who did that? = record API calls to AWS
    ‚Ä¢ Inspector for security assessment

Inspector  = security assessment

Config  Settings /  config / rules
CloudTrail  API calls / who did
Inspector   Assessment on security


Global pharma:
    ‚Ä¢ External vendors access to S3 buckets
    ‚Ä¢ No longer affiliated to the company - remove access immediately
    ‚Ä¢ SCP - service control policy at OU level which is the 2nd major units right under Organization chart
    ‚Ä¢ Org > OU > R & D
    ‚Ä¢ Possible reason:
        ‚Ä¢ SCP does NOT apply to users outside the AWS organization!
        
        ‚Ä¢ üëÄ this is IMPORTANT:
            ¬ß SCP can be very powerful within your org, but it does NOT apply to external vendors
            ¬ß You can NOT block access to external accounts beyond your existing organization
            ¬ß This could be a serious security breach if left unchecked.


Financial firm:
    ‚Ä¢ Client banking apps
    ‚Ä¢ EC2, multi AZ, us-east-1
    ‚Ä¢ Notification for config changes and config history (AWS Config? - how to get history record? Logs?)
    ‚Ä¢ Detailed records of user activity to AWS resources for security compliance (API calls, CloudTrail)
        ‚Ä¢ Enable AWS Config in us-east-1 which is the same region where EC2 were deployed
        ‚Ä¢ Use Config to check changes made to EC2 instance
        ‚Ä¢ Specify S3 bucket to collect AWS CloudTrail logs which will capture user activity

‚ö°
Config  Enabled per Region based
S3 logs for CloudTrail  Enabled at account level / All AWS resources - specify S3 - no need for each region
    

Global news channel stores:
    ‚Ä¢ S3, across the globe
    ‚Ä¢ Different sets of permission ‚õë to different teams
    ‚Ä¢ Configure the policy on daily basis based upon recurring media events
    ‚Ä¢ Least admin work - high efficiency:
        ‚Ä¢ Create IAM policy for different permissions required on different S3 buckets
        ‚Ä¢ If there are too many S3 buckets to manage, we should use IAM policy - to reduce admin work and easy to manage
        ‚Ä¢ S3 bucket policy is NOT supported on object level
        ‚Ä¢ Manage each of the thousands S3 buckets individually will be tedious - use IAM policy instead 

VPC with CIDR:
    ‚Ä¢ 10.0.0.0/16
    ‚Ä¢ Public and Private subnet with CIDR 
    ‚Ä¢ Internet GW
    ‚Ä¢ What's required?
        ‚Ä¢ Add Route entry of Destination of 0.0.0.0/0 which is bound for the public Internet and the Target as the Internet Gateway
        ‚Ä¢ 


Large pharma:
    ‚Ä¢ Multiple accounts across regions based upon operational verticals
    ‚Ä¢ Consolidated billing - AWS Org - Master account
        ‚Ä¢ Create Organization and OU üèó
        ‚Ä¢ Invite an external account to join your Org ü§ù
        ‚Ä¢ Pay all charges accrued by all the affiliated accounts within the org üí≤

Start up:
    ‚Ä¢ S3 - test bucket
    ‚Ä¢ ONLY by user ABC in specific account
    ‚Ä¢ Replicate x 50 for their corresponding bucket
    ‚Ä¢ Ensure least privileges
        ‚Ä¢  Effect: Allow
        ‚Ä¢ Principal == the user who is accessible  == AWS account No. 
        
        
        ‚Ä¢ Specify user account
        ‚Ä¢ Specify down to the bucket name with wildcard s3:::test bucket/*
        ‚Ä¢ NOTE: must specify BOTH account ID AND bucket name == least privileges


Admin:
    ‚Ä¢ Effect: Allow
    ‚Ä¢ Action: S3: List Bucket
    ‚Ä¢ Resource: S3:::demo bucket
    ‚Ä¢ Action: S3: Put Object == Upload / Add to
    ‚Ä¢ Action: S3 Get Object == Read / Pull from
        ‚Ä¢ Add object to the demo bucket
        ‚Ä¢ Read an object from the demo bucket

Web app:
    ‚Ä¢ VPC - us-east-1
    ‚Ä¢ Manual error outage
    ‚Ä¢ Preventive measure - create a process to evaluate these security policies post deployment
    ‚Ä¢ Most effective way
        ‚Ä¢ Add CloudWatch Event rule to automatically trigger Network Assessment post changes in Security Groups
        ‚Ä¢ Add CloudWatch Even rule to auto trigger assessment post changes in SG
        
    
    

Private bank:
    ‚Ä¢ S3, all transaction documents, annual audit
    ‚Ä¢ Found unencrypted uploaded
    ‚Ä¢ Ensure no object should be stored IN the bucket without SS#:KMS encryption enabled
        ‚Ä¢ Create S3 bucket policy which will DENY an object upload request without header for server-side encryption with SSE-KMS
        ‚Ä¢ S3 bucket policy - deny object upload without 

Company:
    ‚Ä¢ S3 office document
    ‚Ä¢ ALL objects encrypted at rest == IN bucket üîê
        ‚Ä¢ SSE - S3 - AES 256
        ‚Ä¢ SSE - KMS
    ‚Ä¢ SSL / TLS == In-transit NOT at rest


IT firm:
    ‚Ä¢ S3 bucket
    ‚Ä¢ Uploading project - encrypted using KMS key
        ‚Ä¢ Small file - 200
        ‚Ä¢ Large files - Deny error
        ‚Ä¢ Check if user has permission to perform KMS: Decrypt üîì action in both key policy and IAM policy for files above 100 MB
            ¬ß Both key policy AND IAM policy
            ¬ß BOTH key policy üîë AND IAM policy ‚õëüë∑‚Äç‚ôÇÔ∏è
        


SysOps:
    ‚Ä¢ EC2 extranet app - extra-net == external web
    ‚Ä¢ Automate vulnerability checks
    ‚Ä¢ Amazon Inspector >> Vulnerability Security Assessment
    ‚Ä¢ NO additional agent needs to be part of this installation process
    ‚Ä¢ Install Amazon Inspector automatically in most secure way with least efforts:
        ‚Ä¢ Use Amazon Linus AMI with Amazon Inspector



‚ö° Linux AMI x Amazon Inspector == Fast and Secure


Pharma firm:
    ‚Ä¢ S3, private and confidential
    ‚Ä¢ Monthly time report files
    ‚Ä¢ Bucket Policy: Allow ONLY OAI & Deny all other
    ‚Ä¢ They are still able to access:
        ‚Ä¢ Use Amazon S3 ACL for granting access to OAI and Denying access to other users for files uploaded by the Operations team.

‚ö° Bucket Policy + ACL == Total Block ‚õî


Construction Company:
    ‚Ä¢ S3 - external vendors
    ‚Ä¢ Enhance performance of downloading files - CloudFront
    ‚Ä¢ Help to restrict access to S3
        ‚Ä¢ Create OAI with CloudFront and associate with distribution
        ‚Ä¢ Modify permission on S3 buckets that ONLY OAI has permission to access files

‚ö° Create OAI + Modify ONLY OAI can be allowed = Origin Access Identity

Dashboard metrics:
    ‚Ä¢ CPU utilization
    ‚Ä¢ 1 min
    ‚Ä¢ Easy and cost efficient
        ‚Ä¢ Detailed monitoring for EC2
        ‚Ä¢ Dashboard in CloudWatch

‚ö° 
    ‚Ä¢ Performance visual monitoring >> CloudWatch Dashboard
    ‚Ä¢ 1 minute == Detailed Monitoring (Basic = 5 minute level, cmin -5, mmin -5, amin -5)


Different departments:
    ‚Ä¢ Monthly costing report
    ‚Ä¢ Department wise
        ‚Ä¢ Assign tags to the EC2 instances and generate reports based on the tags

‚ö° cost by department == cost allocation tags

IT firm:
    ‚Ä¢ Consolidated feature
    ‚Ä¢ Invited by master account (pay consolidate bills)
    ‚Ä¢ Implement uniform permission (consistent for ALL) for all member accounts within Org
    ‚Ä¢ Enable SCP for all accounts
    ‚Ä¢ Before enabled all features:
        ‚Ä¢ Send a request to all invited member accounts within AWS Organization
        ‚Ä¢ Get approval to enable all features with AWS Organization

‚ö° Send request to all + Get approval to enable all == Uniform permission - Unanimity - ALL agree ‚úÖ

All members should approve enabling all features!

Consulting firm:
    ‚Ä¢ Publish interactive dashboards report
    ‚Ä¢ QuickSight
        ‚Ä¢ Standard: invite an IAM user and allow to use their credentials to access Amazon QuickSight
        ‚Ä¢ Enterprise: select AD groups in directory services for access to QuickSight
        ‚Ä¢ Standard: Does NOT support encryption at rest, while Enterprise edition supports encryption at rest

‚ö° QuickSight:

    ‚Ä¢ Enterprise: premium-encryption at rest + select AD groups - Enterprise level Active Directory groups
    ‚Ä¢ Standard: invite IAM user + use their credentials - basic access from external 


Ticketing app:
    ‚Ä¢ EC2 instance, MAZ, us-west-1
    ‚Ä¢ CLB with cross zone balancing
    ‚Ä¢ Peak hours - HTTP 504 timeout - server side issue
    ‚Ä¢ Detect issue with CLB
        ‚Ä¢ SurgeQueueLength metric of CLB

‚ö° maximum, peak hours, spill over >> SurgeQueueLength metric


Educational Institute:
    ‚Ä¢ New web app
    ‚Ä¢ ALB
    ‚Ä¢ Audit - IP address for all accessing this app
    ‚Ä¢ Enable access logs create S3 bucket (account level logs for S3)
        ‚Ä¢ S3 need to be in the same region as that of ALB
        ‚Ä¢ Can be owned by a separate account from that of ALB

üèõ https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html

‚ö°üß† 
    ‚Ä¢ S3 bucket in the SAME Region as the ALB
    ‚Ä¢ Can be owned by a separate account from that of ALB


Large telecom:
    ‚Ä¢ Web app & data storage app
    ‚Ä¢ IAM user groups - department
    ‚Ä¢ Save all data in EFS store - can be expansive
    ‚Ä¢ Save all data in S3
    ‚Ä¢ ONLY access S3 for savings files: PutObject ONLY
        ‚Ä¢ IAM policy which allows full permission to users in DevOps team to launch EC2 instance
        ‚Ä¢ Create an additional statement allowing iam:PassRole to associate ONLY S3 access role with the instance

EC2 - full permission to launch EC2 instance
S3 - iam:PassRole - least privilege

    
‚ö°üß†
    ‚Ä¢ iam:PassRole == ensure LEAST privilege

    
Hybrid architecture:
    ‚Ä¢ Web app
    ‚Ä¢ Legacy app still installed on prem - can we use CloudWatch agent? - can CloudWatch agent work with legacy app
    ‚Ä¢ AWS System Manger Agent on EC2 - monitor
        ‚Ä¢ Configure CloudWatch agent on-prem Windows servers to retrieve custom metrics from legacy app using StatsD protocol
        
‚ö° CloudWatch Agent: custom metrics + BOTH on-prem AND AWS

Custom VPC:
    ‚Ä¢ NOT received public DNS Name
    ‚Ä¢ Ensure EC2 instance receives public DNS name
        ‚Ä¢ Enable DNS Hostnames setting
        ‚Ä¢ Enable DNS support setting

‚ö° enable DNS!
    1. Enable DNS hostnames
    2. Enable DNS support


AWS Direct Connect:
    ‚Ä¢ Physical connection
    ‚Ä¢ AWS VPC and on-prem data center
    ‚Ä¢ Pre-requisite
        ‚Ä¢ Single mode fiber with a 1000BASE-LX
        ‚Ä¢ Network device on your side must support BGP

‚ö° single Mode (for 1 Direct Connect) + BGP (Border Gateway Protocol for ultra speed) == Direct Connect


Inspector: Vulnerability Security Assessment

SysOps:
    ‚Ä¢ Manage migration of on-prem app
    ‚Ä¢ Number of EC2 instance - ensure within applicable limits
        ‚Ä¢ AWS Trusted Advisor üë®‚Äçüè´ == Trusted Advisor == General Best Practices!
        ‚Ä¢ No of EC2 are within applicable limits
            ¬ß Trusted Advisor can be used to check usage details of AWS resources whether they are within the service limits
        
‚ö° Trusted Advisor == General Best Practices / General Service Limits


System Admin:
    ‚Ä¢ EC2
    ‚Ä¢ NO public IP address
        ‚Ä¢ Modify the auto-assign public IP setting on the subnet

‚ö°üß† auto-assign public IP in the Subnet level!

E-commerce:
    ‚Ä¢ Web app, ALB
    ‚Ä¢ Lambda function - query parameter key, HTTP headers
    ‚Ä¢ Size and color options
    ‚Ä¢ ONLY one NOT both
    ‚Ä¢ Quick solution
        ‚Ä¢ Multi-Value headers for Target groups with Target as Lambda function
